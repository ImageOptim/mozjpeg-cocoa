CFLAGS ?= -O3 -flto -DTARGA_SUPPORTED -DPNG_SUPPORTED $(shell pkg-config --cflags libpng)
LDFLAGS ?= -flto $(shell pkg-config --libs-only-L --static libpng) /usr/local/Cellar/libpng/1.6.15/lib/libpng16.a -lz
SIMDOBJ=simd/jccolor-sse2-64.o simd/jcgray-sse2-64.o simd/jcsample-sse2-64.o simd/jdcolor-sse2-64.o simd/jdmerge-sse2-64.o simd/jdsample-sse2-64.o simd/jfdctflt-sse-64.o simd/jfdctfst-sse2-64.o simd/jfdctint-sse2-64.o simd/jidctflt-sse2-64.o simd/jidctfst-sse2-64.o simd/jidctint-sse2-64.o simd/jidctred-sse2-64.o simd/jquantf-sse2-64.o simd/jquanti-sse2-64.o simd/jsimd_x86_64.o
#SIMDOBJ=jsimd_none.o

CJPEGOBJ=cjpeg.o rdtarga.o cdjpeg.o rdjpeg.o rdswitch.o rdpng.o
ENCOBJ=jcapimin.o jcapistd.o jccoefct.o jccolor.o jcdctmgr.o jchuff.o jchuff.o jcinit.o jcmainct.o jcmarker.o jcmaster.o jcomapi.o jcparam.o jcphuff.o jcprepct.o jcsample.o jcarith.o
DECOBJ=jdapimin.o jdapistd.o jdatadst.o jdatasrc.o jdcoefct.o jdcolor.o jddctmgr.o jdhuff.o jdinput.o jdmainct.o jdmarker.o jdmaster.o jdmerge.o jdphuff.o jdpostct.o jdsample.o jdarith.o
UTILOBJ=jerror.o jfdctflt.o jfdctfst.o jfdctint.o jidctflt.o jidctfst.o jidctint.o jidctred.o jmemmgr.o jmemnobs.o jquant1.o jquant2.o jutils.o jcext.o jaricom.o

cjpeg: $(CJPEGOBJ) $(ENCOBJ) $(DECOBJ) $(UTILOBJ) $(SIMDOBJ)
	$(CC) $(LDFLAGS)  -o $@ $^

# %.asm: %.o:
# 	.simd/nasm_lt.sh nasm -I simd -D__x86_64__ $<

